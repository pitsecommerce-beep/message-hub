import{u as K}from"./useQuery-D47Ue_YD.js";import{C as y,f as d,d as m,b as s,c as D,p as g,o as u,O as f,e as B,q as S,D as A,w as C}from"./index-CEkNgELi.js";import{u as h}from"./useMutation-COeJoQaC.js";function x(a){return K({queryKey:["knowledge-bases",a],queryFn:async()=>a?(await g(S(u(s,"knowledgeBases"),C("orgId","==",a),A("createdAt","desc")))).docs.map(e=>({id:e.id,...e.data()})):[],enabled:!!a})}function F(){const a=y();return h({mutationFn:async({kbId:t,name:e,description:l,orgId:n,rows:r,columns:b})=>{const i=t??`kb_${Date.now()}`,k=m(s,"knowledgeBases",i);if(await D(k,{name:e,description:l??"",orgId:n,rowCount:r.length,columns:b,createdAt:B(),updatedAt:B()}),t){const o=await g(u(s,"knowledgeBases",i,"rows")),c=f(s);o.docs.forEach(w=>c.delete(w.ref)),await c.commit()}const p=500;for(let o=0;o<r.length;o+=p){const c=f(s);r.slice(o,o+p).forEach((w,q)=>{const E=m(u(s,"knowledgeBases",i,"rows"));c.set(E,{...w,_rowIndex:o+q})}),await c.commit()}return i},onSuccess:(t,{orgId:e})=>{a.invalidateQueries({queryKey:["knowledge-bases",e]}),d.success("Base de datos importada")},onError:t=>d.error(t.message)})}function R(a){const t=y();return h({mutationFn:async e=>{const l=await g(u(s,"knowledgeBases",e,"rows")),n=f(s);l.docs.forEach(r=>n.delete(r.ref)),n.delete(m(s,"knowledgeBases",e)),await n.commit()},onSuccess:()=>{t.invalidateQueries({queryKey:["knowledge-bases",a]}),d.success("Base de datos eliminada")},onError:e=>d.error(e.message)})}export{R as a,F as b,x as u};
