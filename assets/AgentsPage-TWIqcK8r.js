import{r as b,j as e,l as E,A as $,B as N,K as I}from"./index-CEkNgELi.js";import{u as G,t as W,C as P,o as X,b as J,c as T,s as w,e as Q}from"./types-BT89ZYJ-.js";import{u as Y,a as Z,b as ee}from"./use-config-BTq_Od9e.js";import{u as se}from"./use-knowledge-base-lXwxMSJL.js";import{I as k}from"./input-DcbaJggM.js";import{L as f}from"./label-3qLALYJI.js";import{P as ae,T as te}from"./textarea-C2pLspGe.js";import{b as re,P as L,c as ne,a as ie}from"./index-BDvAr04x.js";import{u as O}from"./index-DF1d7nOt.js";import{u as oe,e as ce,S as R,a as z,b as D,c as _,d as A}from"./select-BTLA4ZYH.js";import{B as K}from"./badge-mSajl2YX.js";import{D as le,a as de,b as me,c as pe,d as ue}from"./dialog-BJxJDHiE.js";import{P as M,T as xe}from"./trash-2-tC72G8D7.js";import"./useQuery-D47Ue_YD.js";import"./useMutation-COeJoQaC.js";import"./index-CMB1mmzH.js";import"./index-BlA8k1Vs.js";import"./index-lvnVN3aE.js";var B="Switch",[he]=ie(B),[ve,ge]=he(B),q=b.forwardRef((n,i)=>{const{__scopeSwitch:s,name:c,checked:m,defaultChecked:h,required:p,disabled:l,value:u="on",onCheckedChange:j,form:d,...o}=n,[t,x]=b.useState(null),C=O(i,g=>x(g)),a=b.useRef(!1),r=t?d||!!t.closest("form"):!0,[v,y]=re({prop:m,defaultProp:h??!1,onChange:j,caller:B});return e.jsxs(ve,{scope:s,checked:v,disabled:l,children:[e.jsx(L.button,{type:"button",role:"switch","aria-checked":v,"aria-required":p,"data-state":U(v),"data-disabled":l?"":void 0,disabled:l,value:u,...o,ref:C,onClick:ne(n.onClick,g=>{y(S=>!S),r&&(a.current=g.isPropagationStopped(),a.current||g.stopPropagation())})}),r&&e.jsx(F,{control:t,bubbles:!a.current,name:c,value:u,checked:v,required:p,disabled:l,form:d,style:{transform:"translateX(-100%)"}})]})});q.displayName=B;var H="SwitchThumb",V=b.forwardRef((n,i)=>{const{__scopeSwitch:s,...c}=n,m=ge(H,s);return e.jsx(L.span,{"data-state":U(m.checked),"data-disabled":m.disabled?"":void 0,...c,ref:i})});V.displayName=H;var je="SwitchBubbleInput",F=b.forwardRef(({__scopeSwitch:n,control:i,checked:s,bubbles:c=!0,...m},h)=>{const p=b.useRef(null),l=O(p,h),u=oe(s),j=ce(i);return b.useEffect(()=>{const d=p.current;if(!d)return;const o=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(o,"checked").set;if(u!==s&&x){const C=new Event("click",{bubbles:c});x.call(d,s),d.dispatchEvent(C)}},[u,s,c]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...m,tabIndex:-1,ref:l,style:{...m.style,...j,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});F.displayName=je;function U(n){return n?"checked":"unchecked"}var fe=q,be=V;function ye({className:n,...i}){return e.jsx(fe,{className:E("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent","transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-500 focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","data-[state=checked]:bg-brand-600 data-[state=unchecked]:bg-white/20",n),...i,children:e.jsx(be,{className:E("pointer-events-none block h-4 w-4 rounded-full bg-white shadow-lg ring-0 transition-transform","data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})})}const we={openai:["gpt-4o","gpt-4o-mini","gpt-4-turbo","gpt-3.5-turbo"],anthropic:["claude-opus-4-5","claude-sonnet-4-5","claude-haiku-3-5"],custom:[]},Ne=X({name:w().min(1,"Nombre requerido"),provider:Q(["openai","anthropic","custom"]),model:w().min(1,"Modelo requerido"),apiKey:w().min(1,"API Key requerida"),endpoint:w().optional(),systemPrompt:w().min(10,"El system prompt debe tener al menos 10 caracteres"),knowledgeBases:T(w()).optional(),channels:T(w()).optional(),active:J()});function Ce({open:n,onOpenChange:i,agent:s,orgId:c,kbs:m}){const h=ee(c),{register:p,control:l,handleSubmit:u,watch:j,reset:d,formState:{errors:o}}=G({resolver:W(Ne),defaultValues:s?{name:s.name,provider:s.provider,model:s.model,apiKey:"",endpoint:s.endpoint??"",systemPrompt:s.systemPrompt,knowledgeBases:s.knowledgeBases??[],channels:s.channels??[],active:s.active}:{provider:"openai",active:!0,knowledgeBases:[],channels:[]}}),t=j("provider");j("knowledgeBases"),j("channels");async function x(a){c&&(await h.mutateAsync({id:s==null?void 0:s.id,...a,provider:a.provider,channels:a.channels,orgId:c}),i(!1),d())}const C=[{value:"whatsapp",label:"WhatsApp",icon:"ðŸ“±"},{value:"instagram",label:"Instagram",icon:"ðŸ“·"},{value:"messenger",label:"Messenger",icon:"ðŸ’¬"}];return e.jsx(le,{open:n,onOpenChange:a=>{h.isPending||(i(a),d())},children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsx(me,{children:e.jsx(pe,{children:s?"Editar Agente":"Crear Agente IA"})}),e.jsxs("form",{onSubmit:u(x),className:"space-y-4 max-h-[70vh] overflow-y-auto pr-1",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"Nombre del agente *"}),e.jsx(k,{placeholder:"Agente de Ventas...",...p("name")}),o.name&&e.jsx("p",{className:"text-xs text-red-400",children:o.name.message})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"Proveedor *"}),e.jsx(P,{name:"provider",control:l,render:({field:a})=>e.jsxs(R,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(D,{})}),e.jsxs(_,{children:[e.jsx(A,{value:"openai",children:"OpenAI (GPT)"}),e.jsx(A,{value:"anthropic",children:"Anthropic (Claude)"}),e.jsx(A,{value:"custom",children:"Personalizado"})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"Modelo *"}),t==="custom"?e.jsx(k,{placeholder:"nombre-del-modelo",...p("model")}):e.jsx(P,{name:"model",control:l,render:({field:a})=>e.jsxs(R,{value:a.value,onValueChange:a.onChange,children:[e.jsx(z,{children:e.jsx(D,{placeholder:"Seleccionar modelo..."})}),e.jsx(_,{children:(we[t]??[]).map(r=>e.jsx(A,{value:r,children:r},r))})]})}),o.model&&e.jsx("p",{className:"text-xs text-red-400",children:o.model.message})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"API Key *"}),e.jsx(k,{type:"password",placeholder:"sk-...",...p("apiKey")}),o.apiKey&&e.jsx("p",{className:"text-xs text-red-400",children:o.apiKey.message})]})]}),t==="custom"&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"URL del Endpoint"}),e.jsx(k,{placeholder:"https://api.custom.com/v1/chat/completions",...p("endpoint")})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"System Prompt *"}),e.jsx(te,{rows:4,placeholder:"Eres un agente de atenciÃ³n al cliente amable...",...p("systemPrompt")}),o.systemPrompt&&e.jsx("p",{className:"text-xs text-red-400",children:o.systemPrompt.message})]}),m.length>0&&e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"Bases de datos asignadas"}),e.jsx(P,{name:"knowledgeBases",control:l,render:({field:a})=>e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(r=>{var y;const v=((y=a.value)==null?void 0:y.includes(r.id))??!1;return e.jsx("button",{type:"button",onClick:()=>{const g=a.value??[];a.onChange(v?g.filter(S=>S!==r.id):[...g,r.id])},className:`text-xs px-3 py-1.5 rounded-lg border transition-colors ${v?"border-brand-500 bg-brand-600/15 text-brand-300":"border-white/15 text-gray-400 hover:bg-white/5"}`,children:r.name},r.id)})})})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(f,{children:"Canales"}),e.jsx(P,{name:"channels",control:l,render:({field:a})=>e.jsx("div",{className:"flex gap-2",children:C.map(r=>{var y;const v=((y=a.value)==null?void 0:y.includes(r.value))??!1;return e.jsxs("button",{type:"button",onClick:()=>{const g=a.value??[];a.onChange(v?g.filter(S=>S!==r.value):[...g,r.value])},className:`flex items-center gap-2 text-xs px-3 py-2 rounded-xl border transition-colors ${v?"border-brand-500 bg-brand-600/15 text-brand-300":"border-white/15 text-gray-400 hover:bg-white/5"}`,children:[r.icon," ",r.label]},r.value)})})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{name:"active",control:l,render:({field:a})=>e.jsx(ye,{checked:a.value,onCheckedChange:a.onChange,id:"active-switch"})}),e.jsx(f,{htmlFor:"active-switch",children:"Agente activo"})]})]}),e.jsxs(ue,{children:[e.jsx(N,{variant:"outline",onClick:()=>{i(!1),d()},disabled:h.isPending,children:"Cancelar"}),e.jsx(N,{onClick:u(x),loading:h.isPending,children:s?"Guardar Cambios":"Crear Agente"})]})]})})}function Ve(){const{userData:n,organization:i}=$(),s=(n==null?void 0:n.orgId)??(i==null?void 0:i.id),{data:c=[],isLoading:m}=Y(s),{data:h=[]}=se(s),p=Z(s),[l,u]=b.useState(!1),[j,d]=b.useState(null);function o(){d(null),u(!0)}return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:[c.length," agentes configurados"]}),e.jsxs(N,{onClick:o,children:[e.jsx(M,{size:14})," Crear Agente"]})]}),m&&e.jsx("div",{className:"py-16 text-center text-gray-600 animate-pulse",children:"Cargando..."}),!m&&c.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-24 gap-4",children:[e.jsx(I,{size:48,className:"text-gray-700"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-medium text-gray-400",children:"Sin agentes IA"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Crea un agente para automatizar respuestas en tus canales de mensajerÃ­a"})]}),e.jsxs(N,{onClick:o,children:[e.jsx(M,{size:14})," Crear primer agente"]})]}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:c.map(t=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 p-4 space-y-3 hover:border-white/20 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"h-9 w-9 rounded-xl bg-purple-600/15 flex items-center justify-center",children:e.jsx(I,{size:18,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white text-sm",children:t.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.provider," Â· ",t.model]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(N,{variant:"ghost",size:"icon-sm",onClick:()=>{d(t),u(!0)},children:e.jsx(ae,{size:13})}),e.jsx(N,{variant:"ghost",size:"icon-sm",className:"text-gray-500 hover:text-red-400",onClick:()=>{confirm(`Â¿Eliminar "${t.name}"?`)&&p.mutate(t.id)},children:e.jsx(xe,{size:13})})]})]}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:t.systemPrompt}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[e.jsx(K,{variant:t.active?"success":"secondary",children:t.active?"Activo":"Inactivo"}),(t.channels??[]).map(x=>e.jsxs(K,{variant:"secondary",children:[x==="whatsapp"?"ðŸ“±":x==="instagram"?"ðŸ“·":"ðŸ’¬"," ",x]},x))]})]},t.id))}),e.jsx(Ce,{open:l,onOpenChange:t=>{u(t),t||d(null)},agent:j,orgId:s,kbs:h})]})}export{Ve as default};
