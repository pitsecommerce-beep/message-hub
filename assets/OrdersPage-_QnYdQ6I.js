import{C as N,f as p,t as y,e as S,d as w,b as v,p as C,q as T,D as E,w as L,o as A,A as P,r as h,j as e,B as I,S as B,L as D,T as O}from"./index-CEkNgELi.js";import{u as q}from"./useQuery-D47Ue_YD.js";import{u as F}from"./useMutation-COeJoQaC.js";import{I as R}from"./input-DcbaJggM.js";import{B as U}from"./badge-mSajl2YX.js";import{S as z,a as k,b as Q,c as _,d as K}from"./select-BTLA4ZYH.js";import{S as M}from"./search-CCqM6hse.js";import{R as V}from"./refresh-cw-Dp3bY8B6.js";import"./index-BDvAr04x.js";import"./index-DF1d7nOt.js";import"./index-CMB1mmzH.js";import"./index-BlA8k1Vs.js";function $(t){return q({queryKey:["orders",t],queryFn:async()=>t?(await C(T(A(v,"orders"),L("orgId","==",t),E("createdAt","desc")))).docs.map(r=>({id:r.id,...r.data()})):[],enabled:!!t})}function G(t){const s=N();return F({mutationFn:async({orderId:r,status:l})=>{await y(w(v,"orders",r),{status:l,updatedAt:S()})},onSuccess:()=>{s.invalidateQueries({queryKey:["orders",t]}),p.success("Estado actualizado")},onError:r=>p.error(r.message)})}const g={pendiente:{label:"Pendiente",variant:"warning"},procesando:{label:"Procesando",variant:"info"},enviado:{label:"Enviado",variant:"info"},entregado:{label:"Entregado",variant:"success"},cancelado:{label:"Cancelado",variant:"destructive"}},X=["pendiente","procesando","enviado","entregado","cancelado"];function H(t){return t?t instanceof O?t.toDate():t instanceof Date?t:null:null}function J(t){const s=H(t);return s?s.toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric"}):"—"}const W=[{value:"all",label:"Todos"},{value:"pendiente",label:"Pendientes"},{value:"procesando",label:"Procesando"},{value:"enviado",label:"Enviados"},{value:"entregado",label:"Entregados"},{value:"cancelado",label:"Cancelados"}];function Y({order:t,onStatusChange:s,isUpdating:r}){const l=g[t.status];return e.jsxs("tr",{className:"hover:bg-white/3 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-white font-mono",children:t.orderNumber}),e.jsx("p",{className:"text-xs text-gray-500",children:J(t.createdAt)})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("p",{className:"text-sm text-gray-200",children:t.contactName})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(U,{variant:l.variant,children:l.label})}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("p",{className:"text-sm text-white font-medium",children:t.total!=null?D(t.total):"—"}),t.items&&t.items.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[t.items.length," artículo(s)"]})]}),e.jsx("td",{className:"px-4 py-3 text-xs text-gray-400 max-w-[200px] truncate",children:t.notes??"—"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(z,{value:t.status,onValueChange:n=>s(t.id,n),disabled:r,children:[e.jsx(k,{className:"h-8 w-36 text-xs",children:e.jsx(Q,{})}),e.jsx(_,{children:X.map(n=>e.jsx(K,{value:n,className:"text-xs",children:g[n].label},n))})]})})]})}function xe(){const{userData:t,organization:s}=P(),r=(t==null?void 0:t.orgId)??(s==null?void 0:s.id),{data:l=[],isLoading:n,refetch:b}=$(r),u=G(r),[o,j]=h.useState(""),[i,f]=h.useState("all"),d=l.filter(a=>{const x=a.orderNumber.toLowerCase().includes(o.toLowerCase())||a.contactName.toLowerCase().includes(o.toLowerCase())||(a.notes??"").toLowerCase().includes(o.toLowerCase()),m=i==="all"||a.status===i;return x&&m}),c={total:l.length,pending:l.filter(a=>a.status==="pendiente").length,processing:l.filter(a=>a.status==="procesando").length,delivered:l.filter(a=>a.status==="entregado").length};return e.jsxs("div",{className:"space-y-5",children:[e.jsx("div",{className:"grid grid-cols-2 gap-3 lg:grid-cols-4",children:[{label:"Total",value:c.total,color:"text-white"},{label:"Pendientes",value:c.pending,color:"text-amber-400"},{label:"Procesando",value:c.processing,color:"text-blue-400"},{label:"Entregados",value:c.delivered,color:"text-green-400"}].map(a=>e.jsxs("div",{className:"rounded-xl border border-white/10 bg-white/5 px-4 py-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:a.label}),e.jsx("p",{className:`text-2xl font-bold mt-1 ${a.color}`,children:a.value})]},a.label))}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(M,{size:14,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"}),e.jsx(R,{className:"pl-8",placeholder:"Buscar pedidos...",value:o,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[W.map(a=>e.jsx("button",{onClick:()=>f(a.value),className:`text-xs px-3 py-1.5 rounded-lg transition-colors ${i===a.value?"bg-brand-600/20 text-brand-300 border border-brand-500/30":"text-gray-500 hover:text-gray-300 hover:bg-white/5"}`,children:a.label},a.value)),e.jsx(I,{variant:"ghost",size:"icon-sm",onClick:()=>b(),children:e.jsx(V,{size:13,className:n?"animate-spin":""})})]})]}),e.jsxs("div",{className:"rounded-xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white/5",children:e.jsx("tr",{children:["Número","Contacto","Estado","Total","Notas","Cambiar estado"].map(a=>e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider",children:a},a))})}),e.jsxs("tbody",{className:"divide-y divide-white/5",children:[n&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-12 text-center text-gray-600 animate-pulse",children:"Cargando..."})}),!n&&d.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(B,{size:32,className:"text-gray-700"}),e.jsx("p",{className:"text-gray-600",children:o||i!=="all"?"Sin resultados":"Sin pedidos aún. Los pedidos son creados por el agente IA."})]})})}),d.map(a=>e.jsx(Y,{order:a,onStatusChange:(x,m)=>u.mutate({orderId:x,status:m}),isUpdating:u.isPending},a.id))]})]})}),e.jsxs("div",{className:"px-4 py-2 border-t border-white/8 text-xs text-gray-600",children:[d.length," pedidos"]})]})]})}export{xe as default};
