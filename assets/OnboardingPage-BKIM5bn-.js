import{k as _,u as M,r as D,j as e,M as F,l as k,U as G,B as f,m as L,a as d,n as T,c as U,d as C,b as v,e as E,f as w,o as Q,q as V,w as K,p as Y,t as Z,v as ee}from"./index-CEkNgELi.js";import{u as $,t as P,o as H,s as A}from"./types-BT89ZYJ-.js";import{I as X}from"./input-DcbaJggM.js";import{L as B}from"./label-3qLALYJI.js";import{B as se}from"./building-2-NKLHoJag.js";import"./index-DF1d7nOt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],R=_("ArrowLeft",te);function ae(){return"org_"+Math.random().toString(36).slice(2,10)}function re(){const t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",s=a=>Array.from({length:a},()=>t[Math.floor(Math.random()*t.length)]).join("");return`${s(5)}-${s(5)}`}function ne({selectedRole:t,onSelect:s,onNext:a,onBack:n}){return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"¿Cuál es tu rol?"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Esto determinará tus permisos dentro de la plataforma"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("button",{type:"button",onClick:()=>s("gerente"),className:k("flex items-start gap-4 p-4 rounded-xl border text-left transition-all",t==="gerente"?"border-brand-500 bg-brand-600/15":"border-white/15 bg-white/5 hover:bg-white/8"),children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-brand-600/20 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx(se,{size:18,className:"text-brand-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Gerente / Dueño"}),e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:"Crea y administra tu organización, integra canales y gestiona el equipo."})]})]}),e.jsxs("button",{type:"button",onClick:()=>s("agente"),className:k("flex items-start gap-4 p-4 rounded-xl border text-left transition-all",t==="agente"?"border-brand-500 bg-brand-600/15":"border-white/15 bg-white/5 hover:bg-white/8"),children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-purple-600/20 flex items-center justify-center shrink-0 mt-0.5",children:e.jsx(G,{size:18,className:"text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Agente"}),e.jsx("p",{className:"text-sm text-gray-400 mt-0.5",children:"Únete al equipo de tu empresa con un código de invitación y atiende conversaciones."})]})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{variant:"outline",className:"flex-1",onClick:n,children:[e.jsx(R,{size:14})," Cancelar"]}),e.jsx(f,{className:"flex-1",disabled:!t,onClick:a,children:"Continuar"})]})]})}const ie=H({orgName:A().min(2,"Ingresa el nombre de la organización"),industry:A().optional()});function oe({onBack:t,onComplete:s}){const a=M(),{register:n,handleSubmit:j,formState:{errors:m,isSubmitting:x}}=$({resolver:P(ie)});async function z(b){var h;const y=sessionStorage.getItem("pendingRegistration");let o,c,g;try{if(y){const{name:r,email:p,password:S}=JSON.parse(y),N=await L(d,p,S);await T(N.user,{displayName:r}),o=N.user.uid,c=r,g=p}else{const r=d.currentUser;if(!r)throw new Error("No hay usuario autenticado");o=r.uid,c=r.displayName??((h=r.email)==null?void 0:h.split("@")[0])??"Usuario",g=r.email??""}const i=ae(),u=re();await U(C(v,"organizations",i),{name:b.orgName,industry:b.industry??"",ownerId:o,inviteCode:u,createdAt:E(),members:[o],integrations:{whatsapp:!1,instagram:!1,messenger:!1,stripe:!1,mercadopago:!1}}),await U(C(v,"users",o),{name:c,email:g,orgId:i,organizationId:i,role:"gerente",onboarded:!0,createdAt:E()}),sessionStorage.removeItem("pendingRegistration"),w.success(`Organización "${b.orgName}" creada. Código de invitación: ${u}`),s(),a("/")}catch(i){const u=i.message??"Error al crear la organización";w.error(u)}}return e.jsxs("form",{onSubmit:j(z),className:"space-y-5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Crea tu Organización"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Configura el espacio de trabajo para tu equipo"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{children:"Nombre de la organización *"}),e.jsx(X,{placeholder:"Mi Empresa S.A.",...n("orgName")}),m.orgName&&e.jsx("p",{className:"text-xs text-red-400",children:m.orgName.message})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{children:"Industria (opcional)"}),e.jsx(X,{placeholder:"Ej: Comercio, Servicios, Tecnología...",...n("industry")})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{type:"button",variant:"outline",className:"flex-1",onClick:t,children:[e.jsx(R,{size:14})," Atrás"]}),e.jsx(f,{type:"submit",className:"flex-1",loading:x,children:"Crear Organización"})]})]})}const ce=H({inviteCode:A().min(5,"Ingresa el código de invitación")});function le({onBack:t,onComplete:s}){const a=M(),{register:n,handleSubmit:j,formState:{errors:m,isSubmitting:x}}=$({resolver:P(ce)});async function z(b){var u;const y=b.inviteCode.trim().toUpperCase().replace(/\s/g,""),o=sessionStorage.getItem("pendingRegistration");let c,g,h,i=!1;try{if(o){const{name:l,email:O,password:W}=JSON.parse(o),q=await L(d,O,W);await T(q.user,{displayName:l}),c=q.user.uid,g=l,h=O,i=!0}else{const l=d.currentUser;if(!l)throw new Error("No hay usuario autenticado");c=l.uid,g=l.displayName??((u=l.email)==null?void 0:u.split("@")[0])??"Usuario",h=l.email??""}const r=Q(v,"organizations"),p=V(r,K("inviteCode","==",y)),S=await Y(p);if(S.empty){i&&d.currentUser&&await d.currentUser.delete().catch(()=>{}),w.error("Código de invitación no encontrado. Verifica con tu gerente."),sessionStorage.removeItem("pendingRegistration");return}const N=S.docs[0],I=N.id,J=N.data();await Z(C(v,"organizations",I),{members:ee(c)}),await U(C(v,"users",c),{name:g,email:h,orgId:I,organizationId:I,role:"agente",onboarded:!0,createdAt:E()}),sessionStorage.removeItem("pendingRegistration"),w.success(`Te uniste a "${J.name}". ¡Bienvenido!`),s(),a("/")}catch(r){i&&d.currentUser&&await d.currentUser.delete().catch(()=>{});const p=r.message??"Error al unirse a la organización";w.error(p),sessionStorage.removeItem("pendingRegistration")}}return e.jsxs("form",{onSubmit:j(z),className:"space-y-5",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Únete al Equipo"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Ingresa el código de invitación de tu gerente"})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(B,{children:"Código de invitación *"}),e.jsx(X,{placeholder:"XXXXX-XXXXX",className:"uppercase tracking-widest text-center text-lg",...n("inviteCode")}),m.inviteCode&&e.jsx("p",{className:"text-xs text-red-400",children:m.inviteCode.message})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(f,{type:"button",variant:"outline",className:"flex-1",onClick:t,children:[e.jsx(R,{size:14})," Atrás"]}),e.jsx(f,{type:"submit",className:"flex-1",loading:x,children:"Unirse a la Organización"})]})]})}function pe(){const t=M(),[s,a]=D.useState(1),[n,j]=D.useState(null);function m(){s===1?(sessionStorage.removeItem("pendingRegistration"),t("/login")):a(1)}return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-950 px-4",children:[e.jsxs("div",{className:"fixed inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-1/4 left-1/3 w-72 h-72 bg-brand-600/8 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/3 w-96 h-96 bg-purple-600/6 rounded-full blur-3xl"})]}),e.jsxs("div",{className:"w-full max-w-md relative",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3 mb-8",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl bg-brand-600 flex items-center justify-center shadow-lg shadow-brand-600/25",children:e.jsx(F,{size:24,className:"text-white"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"MessageHub"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Configura tu cuenta"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mb-6",children:[1,2].map(x=>e.jsx("div",{className:k("h-1.5 w-8 rounded-full transition-colors",x<=s?"bg-brand-500":"bg-white/15")},x))}),e.jsxs("div",{className:"rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm p-6 shadow-2xl",children:[s===1&&e.jsx(ne,{selectedRole:n,onSelect:j,onNext:()=>a(2),onBack:m}),s===2&&n==="gerente"&&e.jsx(oe,{onBack:()=>a(1),onComplete:()=>{}}),s===2&&n==="agente"&&e.jsx(le,{onBack:()=>a(1),onComplete:()=>{}})]})]})]})}export{pe as default};
