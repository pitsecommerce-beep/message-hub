import{k as bt,C as xt,r as c,q as un,D as dn,o as Me,E as Un,f as ie,F as ht,t as yt,d as wt,b as ae,H as qn,e as je,p as Yn,w as Wn,R,I as Ne,j as l,l as H,M as Ue,J as Ct,T as fn,B as fe,A as Hn,K as gt,X as Vn}from"./index-CEkNgELi.js";import{u as _n}from"./useQuery-D47Ue_YD.js";import{u as Je}from"./useMutation-COeJoQaC.js";import{u as Jn,F as at,a as Gn}from"./index-C3UpIdo2.js";import{T as Qn,a as Zn,b as Vt}from"./tabs-DFJh9Gpf.js";import{P as er,T as tr}from"./textarea-C2pLspGe.js";import{u as nr,C as _t,t as rr,o as sr,s as Jt,e as or}from"./types-BT89ZYJ-.js";import{D as ir,a as ar,b as lr,c as cr,d as ur}from"./dialog-BJxJDHiE.js";import{L as lt}from"./label-3qLALYJI.js";import{S as dr,a as fr,b as hr,c as gr,d as pr}from"./select-BTLA4ZYH.js";import{P as vr,T as mr}from"./trash-2-tC72G8D7.js";import"./index-BDvAr04x.js";import"./index-DF1d7nOt.js";import"./index-CMB1mmzH.js";import"./index-lvnVN3aE.js";import"./index-BlA8k1Vs.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=[["path",{d:"M13.67 8H18a2 2 0 0 1 2 2v4.33",key:"7az073"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M22 22 2 2",key:"1r8tn9"}],["path",{d:"M8 8H6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h12a2 2 0 0 0 1.414-.586",key:"s09a7a"}],["path",{d:"M9 13v2",key:"rq6x2g"}],["path",{d:"M9.67 4H12v2.33",key:"110xot"}]],xr=bt("BotOff",br);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],wr=bt("ChevronRight",yr);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Sr=bt("Send",Cr);function Dr(e){return _n({queryKey:["conversations",e],queryFn:async()=>e?(await Yn(un(Me(ae,"conversations"),Wn("orgId","==",e),dn("lastMessageAt","desc")))).docs.map(n=>({id:n.id,...n.data()})):[],enabled:!!e})}function Nr(e){const[t,n]=c.useState([]),[r,s]=c.useState(!0);return c.useEffect(()=>{if(!e){s(!1);return}const o=un(Me(ae,"conversations",e,"messages"),dn("timestamp","asc"));return Un(o,i=>{n(i.docs.map(u=>({id:u.id,...u.data()}))),s(!1)})},[e]),{messages:t,loading:r}}function jr(){return Je({mutationFn:async({convId:e,text:t,senderName:n,role:r})=>{await ht(Me(ae,"conversations",e,"messages"),{text:t,senderName:n,role:r,timestamp:je()}),await yt(wt(ae,"conversations",e),{lastMessage:t,lastMessageAt:je()})},onError:e=>ie.error(e.message)})}function Er(e){const t=xt();return Je({mutationFn:async n=>{await qn(wt(ae,"conversations",n))},onSuccess:()=>{t.invalidateQueries({queryKey:["conversations",e]}),ie.success("Conversación eliminada")},onError:n=>ie.error(n.message)})}function Rr(e){const t=xt();return Je({mutationFn:async({convId:n,enabled:r})=>{await yt(wt(ae,"conversations",n),{aiEnabled:r})},onSuccess:(n,{enabled:r})=>{t.invalidateQueries({queryKey:["conversations",e]}),ie.success(r?"IA activada":"IA desactivada")},onError:n=>ie.error(n.message)})}function Ar(e){const t=xt();return Je({mutationFn:async({contactId:n,contactName:r,contactPhone:s,platform:o,orgId:a,initialMessage:i,senderName:u})=>{const f=await ht(Me(ae,"conversations"),{contactId:n,contactName:r,contactPhone:s??"",platform:o,orgId:a,createdAt:je(),lastMessageAt:je()});return i&&(await ht(Me(ae,"conversations",f.id,"messages"),{text:i,senderName:u,role:"agent",timestamp:je()}),await yt(f,{lastMessage:i})),f.id},onSuccess:()=>{t.invalidateQueries({queryKey:["conversations",e]}),ie.success("Conversación iniciada")},onError:n=>ie.error(n.message)})}const Ge=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function xe(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function St(e){return"nodeType"in e}function P(e){var t,n;return e?xe(e)?e:St(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Dt(e){const{Document:t}=P(e);return e instanceof t}function Ie(e){return xe(e)?!1:e instanceof P(e).HTMLElement}function hn(e){return e instanceof P(e).SVGElement}function ye(e){return e?xe(e)?e.document:St(e)?Dt(e)?e:Ie(e)||hn(e)?e.ownerDocument:document:document:document}const Q=Ge?c.useLayoutEffect:c.useEffect;function Qe(e){const t=c.useRef(e);return Q(()=>{t.current=e}),c.useCallback(function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t.current==null?void 0:t.current(...r)},[])}function Mr(){const e=c.useRef(null),t=c.useCallback((r,s)=>{e.current=setInterval(r,s)},[]),n=c.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function Te(e,t){t===void 0&&(t=[e]);const n=c.useRef(e);return Q(()=>{n.current!==e&&(n.current=e)},t),n}function Le(e,t){const n=c.useRef();return c.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function qe(e){const t=Qe(e),n=c.useRef(null),r=c.useCallback(s=>{s!==n.current&&(t==null||t(s,n.current)),n.current=s},[]);return[n,r]}function Ye(e){const t=c.useRef();return c.useEffect(()=>{t.current=e},[e]),t.current}let ct={};function Ze(e,t){return c.useMemo(()=>{if(t)return t;const n=ct[e]==null?0:ct[e]+1;return ct[e]=n,e+"-"+n},[e,t])}function gn(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];return r.reduce((o,a)=>{const i=Object.entries(a);for(const[u,f]of i){const h=o[u];h!=null&&(o[u]=h+e*f)}return o},{...t})}}const be=gn(1),We=gn(-1);function Tr(e){return"clientX"in e&&"clientY"in e}function Nt(e){if(!e)return!1;const{KeyboardEvent:t}=P(e.target);return t&&e instanceof t}function Or(e){if(!e)return!1;const{TouchEvent:t}=P(e.target);return t&&e instanceof t}function He(e){if(Or(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Tr(e)?{x:e.clientX,y:e.clientY}:null}const Oe=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Oe.Translate.toString(e),Oe.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Gt="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function kr(e){return e.matches(Gt)?e:e.querySelector(Gt)}const Ir={display:"none"};function Lr(e){let{id:t,value:n}=e;return R.createElement("div",{id:t,style:Ir},n)}function Pr(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return R.createElement("div",{id:t,style:s,role:"status","aria-live":r,"aria-atomic":!0},n)}function zr(){const[e,t]=c.useState("");return{announce:c.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const pn=c.createContext(null);function Fr(e){const t=c.useContext(pn);c.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Br(){const[e]=c.useState(()=>new Set),t=c.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[c.useCallback(r=>{let{type:s,event:o}=r;e.forEach(a=>{var i;return(i=a[s])==null?void 0:i.call(a,o)})},[e]),t]}const $r={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Kr={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Xr(e){let{announcements:t=Kr,container:n,hiddenTextDescribedById:r,screenReaderInstructions:s=$r}=e;const{announce:o,announcement:a}=zr(),i=Ze("DndLiveRegion"),[u,f]=c.useState(!1);if(c.useEffect(()=>{f(!0)},[]),Fr(c.useMemo(()=>({onDragStart(d){let{active:p}=d;o(t.onDragStart({active:p}))},onDragMove(d){let{active:p,over:v}=d;t.onDragMove&&o(t.onDragMove({active:p,over:v}))},onDragOver(d){let{active:p,over:v}=d;o(t.onDragOver({active:p,over:v}))},onDragEnd(d){let{active:p,over:v}=d;o(t.onDragEnd({active:p,over:v}))},onDragCancel(d){let{active:p,over:v}=d;o(t.onDragCancel({active:p,over:v}))}}),[o,t])),!u)return null;const h=R.createElement(R.Fragment,null,R.createElement(Lr,{id:r,value:s.draggable}),R.createElement(Pr,{id:i,announcement:a}));return n?Ne.createPortal(h,n):h}var M;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(M||(M={}));function Ve(){}function Ur(e,t){return c.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function qr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return c.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const q=Object.freeze({x:0,y:0});function Yr(e,t){const n=He(e);if(!n)return"0 0";const r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}function Wr(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Hr(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function Vr(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),s=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),a=s-r,i=o-n;if(r<s&&n<o){const u=t.width*t.height,f=e.width*e.height,h=a*i,d=h/(u+f-h);return Number(d.toFixed(4))}return 0}const _r=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const s=[];for(const o of r){const{id:a}=o,i=n.get(a);if(i){const u=Vr(i,t);u>0&&s.push({id:a,data:{droppableContainer:o,value:u}})}}return s.sort(Wr)};function Jr(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function vn(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:q}function Gr(e){return function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];return s.reduce((a,i)=>({...a,top:a.top+e*i.y,bottom:a.bottom+e*i.y,left:a.left+e*i.x,right:a.right+e*i.x}),{...n})}}const Qr=Gr(1);function mn(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function Zr(e,t,n){const r=mn(t);if(!r)return e;const{scaleX:s,scaleY:o,x:a,y:i}=r,u=e.left-a-(1-s)*parseFloat(n),f=e.top-i-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),h=s?e.width/s:e.width,d=o?e.height/o:e.height;return{width:h,height:d,top:f,right:u+h,bottom:f+d,left:u}}const es={ignoreTransform:!1};function Pe(e,t){t===void 0&&(t=es);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:f,transformOrigin:h}=P(e).getComputedStyle(e);f&&(n=Zr(n,f,h))}const{top:r,left:s,width:o,height:a,bottom:i,right:u}=n;return{top:r,left:s,width:o,height:a,bottom:i,right:u}}function Qt(e){return Pe(e,{ignoreTransform:!0})}function ts(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function ns(e,t){return t===void 0&&(t=P(e).getComputedStyle(e)),t.position==="fixed"}function rs(e,t){t===void 0&&(t=P(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const o=t[s];return typeof o=="string"?n.test(o):!1})}function jt(e,t){const n=[];function r(s){if(t!=null&&n.length>=t||!s)return n;if(Dt(s)&&s.scrollingElement!=null&&!n.includes(s.scrollingElement))return n.push(s.scrollingElement),n;if(!Ie(s)||hn(s)||n.includes(s))return n;const o=P(e).getComputedStyle(s);return s!==e&&rs(s,o)&&n.push(s),ns(s,o)?n:r(s.parentNode)}return e?r(e):n}function bn(e){const[t]=jt(e,1);return t??null}function ut(e){return!Ge||!e?null:xe(e)?e:St(e)?Dt(e)||e===ye(e).scrollingElement?window:Ie(e)?e:null:null}function xn(e){return xe(e)?e.scrollX:e.scrollLeft}function yn(e){return xe(e)?e.scrollY:e.scrollTop}function pt(e){return{x:xn(e),y:yn(e)}}var O;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(O||(O={}));function wn(e){return!Ge||!e?!1:e===document.scrollingElement}function Cn(e){const t={x:0,y:0},n=wn(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},s=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,a=e.scrollTop>=r.y,i=e.scrollLeft>=r.x;return{isTop:s,isLeft:o,isBottom:a,isRight:i,maxScroll:r,minScroll:t}}const ss={x:.2,y:.2};function os(e,t,n,r,s){let{top:o,left:a,right:i,bottom:u}=n;r===void 0&&(r=10),s===void 0&&(s=ss);const{isTop:f,isBottom:h,isLeft:d,isRight:p}=Cn(e),v={x:0,y:0},m={x:0,y:0},g={height:t.height*s.y,width:t.width*s.x};return!f&&o<=t.top+g.height?(v.y=O.Backward,m.y=r*Math.abs((t.top+g.height-o)/g.height)):!h&&u>=t.bottom-g.height&&(v.y=O.Forward,m.y=r*Math.abs((t.bottom-g.height-u)/g.height)),!p&&i>=t.right-g.width?(v.x=O.Forward,m.x=r*Math.abs((t.right-g.width-i)/g.width)):!d&&a<=t.left+g.width&&(v.x=O.Backward,m.x=r*Math.abs((t.left+g.width-a)/g.width)),{direction:v,speed:m}}function is(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:a}=window;return{top:0,left:0,right:o,bottom:a,width:o,height:a}}const{top:t,left:n,right:r,bottom:s}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:s,width:e.clientWidth,height:e.clientHeight}}function Sn(e){return e.reduce((t,n)=>be(t,pt(n)),q)}function as(e){return e.reduce((t,n)=>t+xn(n),0)}function ls(e){return e.reduce((t,n)=>t+yn(n),0)}function Dn(e,t){if(t===void 0&&(t=Pe),!e)return;const{top:n,left:r,bottom:s,right:o}=t(e);bn(e)&&(s<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const cs=[["x",["left","right"],as],["y",["top","bottom"],ls]];class Et{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=jt(n),s=Sn(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,a,i]of cs)for(const u of a)Object.defineProperty(this,u,{get:()=>{const f=i(r),h=s[o]-f;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Ee{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var s;(s=this.target)==null||s.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function us(e){const{EventTarget:t}=P(e);return e instanceof t?e:ye(e)}function dt(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var K;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(K||(K={}));function Zt(e){e.preventDefault()}function ds(e){e.stopPropagation()}var D;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(D||(D={}));const Nn={start:[D.Space,D.Enter],cancel:[D.Esc],end:[D.Space,D.Enter,D.Tab]},fs=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case D.Right:return{...n,x:n.x+25};case D.Left:return{...n,x:n.x-25};case D.Down:return{...n,y:n.y+25};case D.Up:return{...n,y:n.y-25}}};class jn{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new Ee(ye(n)),this.windowListeners=new Ee(P(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(K.Resize,this.handleCancel),this.windowListeners.add(K.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(K.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&Dn(r),n(q)}handleKeyDown(t){if(Nt(t)){const{active:n,context:r,options:s}=this.props,{keyboardCodes:o=Nn,coordinateGetter:a=fs,scrollBehavior:i="smooth"}=s,{code:u}=t;if(o.end.includes(u)){this.handleEnd(t);return}if(o.cancel.includes(u)){this.handleCancel(t);return}const{collisionRect:f}=r.current,h=f?{x:f.left,y:f.top}:q;this.referenceCoordinates||(this.referenceCoordinates=h);const d=a(t,{active:n,context:r.current,currentCoordinates:h});if(d){const p=We(d,h),v={x:0,y:0},{scrollableAncestors:m}=r.current;for(const g of m){const x=t.code,{isTop:b,isRight:y,isLeft:w,isBottom:T,maxScroll:N,minScroll:j}=Cn(g),C=is(g),S={x:Math.min(x===D.Right?C.right-C.width/2:C.right,Math.max(x===D.Right?C.left:C.left+C.width/2,d.x)),y:Math.min(x===D.Down?C.bottom-C.height/2:C.bottom,Math.max(x===D.Down?C.top:C.top+C.height/2,d.y))},E=x===D.Right&&!y||x===D.Left&&!w,k=x===D.Down&&!T||x===D.Up&&!b;if(E&&S.x!==d.x){const A=g.scrollLeft+p.x,V=x===D.Right&&A<=N.x||x===D.Left&&A>=j.x;if(V&&!p.y){g.scrollTo({left:A,behavior:i});return}V?v.x=g.scrollLeft-A:v.x=x===D.Right?g.scrollLeft-N.x:g.scrollLeft-j.x,v.x&&g.scrollBy({left:-v.x,behavior:i});break}else if(k&&S.y!==d.y){const A=g.scrollTop+p.y,V=x===D.Down&&A<=N.y||x===D.Up&&A>=j.y;if(V&&!p.x){g.scrollTo({top:A,behavior:i});return}V?v.y=g.scrollTop-A:v.y=x===D.Down?g.scrollTop-N.y:g.scrollTop-j.y,v.y&&g.scrollBy({top:-v.y,behavior:i});break}}this.handleMove(t,be(We(d,this.referenceCoordinates),v))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}jn.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Nn,onActivation:s}=t,{active:o}=n;const{code:a}=e.nativeEvent;if(r.start.includes(a)){const i=o.activatorNode.current;return i&&e.target!==i?!1:(e.preventDefault(),s==null||s({event:e.nativeEvent}),!0)}return!1}}];function en(e){return!!(e&&"distance"in e)}function tn(e){return!!(e&&"delay"in e)}class Rt{constructor(t,n,r){var s;r===void 0&&(r=us(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:a}=o;this.props=t,this.events=n,this.document=ye(a),this.documentListeners=new Ee(this.document),this.listeners=new Ee(r),this.windowListeners=new Ee(P(a)),this.initialCoordinates=(s=He(o))!=null?s:q,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(K.Resize,this.handleCancel),this.windowListeners.add(K.DragStart,Zt),this.windowListeners.add(K.VisibilityChange,this.handleCancel),this.windowListeners.add(K.ContextMenu,Zt),this.documentListeners.add(K.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(tn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(en(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:s}=this.props;s(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(K.Click,ds,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(K.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:s,props:o}=this,{onMove:a,options:{activationConstraint:i}}=o;if(!s)return;const u=(n=He(t))!=null?n:q,f=We(s,u);if(!r&&i){if(en(i)){if(i.tolerance!=null&&dt(f,i.tolerance))return this.handleCancel();if(dt(f,i.distance))return this.handleStart()}if(tn(i)&&dt(f,i.tolerance))return this.handleCancel();this.handlePending(i,f);return}t.cancelable&&t.preventDefault(),a(u)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===D.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const hs={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class At extends Rt{constructor(t){const{event:n}=t,r=ye(n.target);super(t,hs,r)}}At.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const gs={move:{name:"mousemove"},end:{name:"mouseup"}};var vt;(function(e){e[e.RightClick=2]="RightClick"})(vt||(vt={}));class ps extends Rt{constructor(t){super(t,gs,ye(t.event.target))}}ps.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===vt.RightClick?!1:(r==null||r({event:n}),!0)}}];const ft={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class vs extends Rt{constructor(t){super(t,ft)}static setup(){return window.addEventListener(ft.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(ft.move.name,t)};function t(){}}}vs.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:s}=n;return s.length>1?!1:(r==null||r({event:n}),!0)}}];var Re;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Re||(Re={}));var _e;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(_e||(_e={}));function ms(e){let{acceleration:t,activator:n=Re.Pointer,canScroll:r,draggingRect:s,enabled:o,interval:a=5,order:i=_e.TreeOrder,pointerCoordinates:u,scrollableAncestors:f,scrollableAncestorRects:h,delta:d,threshold:p}=e;const v=xs({delta:d,disabled:!o}),[m,g]=Mr(),x=c.useRef({x:0,y:0}),b=c.useRef({x:0,y:0}),y=c.useMemo(()=>{switch(n){case Re.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Re.DraggableRect:return s}},[n,s,u]),w=c.useRef(null),T=c.useCallback(()=>{const j=w.current;if(!j)return;const C=x.current.x*b.current.x,S=x.current.y*b.current.y;j.scrollBy(C,S)},[]),N=c.useMemo(()=>i===_e.TreeOrder?[...f].reverse():f,[i,f]);c.useEffect(()=>{if(!o||!f.length||!y){g();return}for(const j of N){if((r==null?void 0:r(j))===!1)continue;const C=f.indexOf(j),S=h[C];if(!S)continue;const{direction:E,speed:k}=os(j,S,y,t,p);for(const A of["x","y"])v[A][E[A]]||(k[A]=0,E[A]=0);if(k.x>0||k.y>0){g(),w.current=j,m(T,a),x.current=k,b.current=E;return}}x.current={x:0,y:0},b.current={x:0,y:0},g()},[t,T,r,g,o,a,JSON.stringify(y),JSON.stringify(v),m,f,N,h,JSON.stringify(p)])}const bs={x:{[O.Backward]:!1,[O.Forward]:!1},y:{[O.Backward]:!1,[O.Forward]:!1}};function xs(e){let{delta:t,disabled:n}=e;const r=Ye(t);return Le(s=>{if(n||!r||!s)return bs;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[O.Backward]:s.x[O.Backward]||o.x===-1,[O.Forward]:s.x[O.Forward]||o.x===1},y:{[O.Backward]:s.y[O.Backward]||o.y===-1,[O.Forward]:s.y[O.Forward]||o.y===1}}},[n,t,r])}function ys(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Le(s=>{var o;return t==null?null:(o=r??s)!=null?o:null},[r,t])}function ws(e,t){return c.useMemo(()=>e.reduce((n,r)=>{const{sensor:s}=r,o=s.activators.map(a=>({eventName:a.eventName,handler:t(a.handler,r)}));return[...n,...o]},[]),[e,t])}var ke;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(ke||(ke={}));var mt;(function(e){e.Optimized="optimized"})(mt||(mt={}));const nn=new Map;function Cs(e,t){let{dragging:n,dependencies:r,config:s}=t;const[o,a]=c.useState(null),{frequency:i,measure:u,strategy:f}=s,h=c.useRef(e),d=x(),p=Te(d),v=c.useCallback(function(b){b===void 0&&(b=[]),!p.current&&a(y=>y===null?b:y.concat(b.filter(w=>!y.includes(w))))},[p]),m=c.useRef(null),g=Le(b=>{if(d&&!n)return nn;if(!b||b===nn||h.current!==e||o!=null){const y=new Map;for(let w of e){if(!w)continue;if(o&&o.length>0&&!o.includes(w.id)&&w.rect.current){y.set(w.id,w.rect.current);continue}const T=w.node.current,N=T?new Et(u(T),T):null;w.rect.current=N,N&&y.set(w.id,N)}return y}return b},[e,o,n,d,u]);return c.useEffect(()=>{h.current=e},[e]),c.useEffect(()=>{d||v()},[n,d]),c.useEffect(()=>{o&&o.length>0&&a(null)},[JSON.stringify(o)]),c.useEffect(()=>{d||typeof i!="number"||m.current!==null||(m.current=setTimeout(()=>{v(),m.current=null},i))},[i,d,v,...r]),{droppableRects:g,measureDroppableContainers:v,measuringScheduled:o!=null};function x(){switch(f){case ke.Always:return!1;case ke.BeforeDragging:return n;default:return!n}}}function Mt(e,t){return Le(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Ss(e,t){return Mt(e,t)}function Ds(e){let{callback:t,disabled:n}=e;const r=Qe(t),s=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return c.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function et(e){let{callback:t,disabled:n}=e;const r=Qe(t),s=c.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return c.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Ns(e){return new Et(Pe(e),e)}function rn(e,t,n){t===void 0&&(t=Ns);const[r,s]=c.useState(null);function o(){s(u=>{if(!e)return null;if(e.isConnected===!1){var f;return(f=u??n)!=null?f:null}const h=t(e);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const a=Ds({callback(u){if(e)for(const f of u){const{type:h,target:d}=f;if(h==="childList"&&d instanceof HTMLElement&&d.contains(e)){o();break}}}}),i=et({callback:o});return Q(()=>{o(),e?(i==null||i.observe(e),a==null||a.observe(document.body,{childList:!0,subtree:!0})):(i==null||i.disconnect(),a==null||a.disconnect())},[e]),r}function js(e){const t=Mt(e);return vn(e,t)}const sn=[];function Es(e){const t=c.useRef(e),n=Le(r=>e?r&&r!==sn&&e&&t.current&&e.parentNode===t.current.parentNode?r:jt(e):sn,[e]);return c.useEffect(()=>{t.current=e},[e]),n}function Rs(e){const[t,n]=c.useState(null),r=c.useRef(e),s=c.useCallback(o=>{const a=ut(o.target);a&&n(i=>i?(i.set(a,pt(a)),new Map(i)):null)},[]);return c.useEffect(()=>{const o=r.current;if(e!==o){a(o);const i=e.map(u=>{const f=ut(u);return f?(f.addEventListener("scroll",s,{passive:!0}),[f,pt(f)]):null}).filter(u=>u!=null);n(i.length?new Map(i):null),r.current=e}return()=>{a(e),a(o)};function a(i){i.forEach(u=>{const f=ut(u);f==null||f.removeEventListener("scroll",s)})}},[s,e]),c.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,a)=>be(o,a),q):Sn(e):q,[e,t])}function on(e,t){t===void 0&&(t=[]);const n=c.useRef(null);return c.useEffect(()=>{n.current=null},t),c.useEffect(()=>{const r=e!==q;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?We(e,n.current):q}function As(e){c.useEffect(()=>{if(!Ge)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Ms(e,t){return c.useMemo(()=>e.reduce((n,r)=>{let{eventName:s,handler:o}=r;return n[s]=a=>{o(a,t)},n},{}),[e,t])}function En(e){return c.useMemo(()=>e?ts(e):null,[e])}const an=[];function Ts(e,t){t===void 0&&(t=Pe);const[n]=e,r=En(n?P(n):null),[s,o]=c.useState(an);function a(){o(()=>e.length?e.map(u=>wn(u)?r:new Et(t(u),u)):an)}const i=et({callback:a});return Q(()=>{i==null||i.disconnect(),a(),e.forEach(u=>i==null?void 0:i.observe(u))},[e]),s}function Rn(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return Ie(t)?t:e}function Os(e){let{measure:t}=e;const[n,r]=c.useState(null),s=c.useCallback(f=>{for(const{target:h}of f)if(Ie(h)){r(d=>{const p=t(h);return d?{...d,width:p.width,height:p.height}:p});break}},[t]),o=et({callback:s}),a=c.useCallback(f=>{const h=Rn(f);o==null||o.disconnect(),h&&(o==null||o.observe(h)),r(h?t(h):null)},[t,o]),[i,u]=qe(a);return c.useMemo(()=>({nodeRef:i,rect:n,setRef:u}),[n,i,u])}const ks=[{sensor:At,options:{}},{sensor:jn,options:{}}],Is={current:{}},Xe={draggable:{measure:Qt},droppable:{measure:Qt,strategy:ke.WhileDragging,frequency:mt.Optimized},dragOverlay:{measure:Pe}};class Ae extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Ls={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Ae,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ve},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Xe,measureDroppableContainers:Ve,windowRect:null,measuringScheduled:!1},An={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ve,draggableNodes:new Map,over:null,measureDroppableContainers:Ve},ze=c.createContext(An),Mn=c.createContext(Ls);function Ps(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Ae}}}function zs(e,t){switch(t.type){case M.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case M.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case M.DragEnd:case M.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case M.RegisterDroppable:{const{element:n}=t,{id:r}=n,s=new Ae(e.droppable.containers);return s.set(r,n),{...e,droppable:{...e.droppable,containers:s}}}case M.SetDroppableDisabled:{const{id:n,key:r,disabled:s}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const a=new Ae(e.droppable.containers);return a.set(n,{...o,disabled:s}),{...e,droppable:{...e.droppable,containers:a}}}case M.UnregisterDroppable:{const{id:n,key:r}=t,s=e.droppable.containers.get(n);if(!s||r!==s.key)return e;const o=new Ae(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Fs(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:s}=c.useContext(ze),o=Ye(r),a=Ye(n==null?void 0:n.id);return c.useEffect(()=>{if(!t&&!r&&o&&a!=null){if(!Nt(o)||document.activeElement===o.target)return;const i=s.get(a);if(!i)return;const{activatorNode:u,node:f}=i;if(!u.current&&!f.current)return;requestAnimationFrame(()=>{for(const h of[u.current,f.current]){if(!h)continue;const d=kr(h);if(d){d.focus();break}}})}},[r,t,s,a,o]),null}function Tn(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((s,o)=>o({transform:s,...r}),n):n}function Bs(e){return c.useMemo(()=>({draggable:{...Xe.draggable,...e==null?void 0:e.draggable},droppable:{...Xe.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Xe.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function $s(e){let{activeNode:t,measure:n,initialRect:r,config:s=!0}=e;const o=c.useRef(!1),{x:a,y:i}=typeof s=="boolean"?{x:s,y:s}:s;Q(()=>{if(!a&&!i||!t){o.current=!1;return}if(o.current||!r)return;const f=t==null?void 0:t.node.current;if(!f||f.isConnected===!1)return;const h=n(f),d=vn(h,r);if(a||(d.x=0),i||(d.y=0),o.current=!0,Math.abs(d.x)>0||Math.abs(d.y)>0){const p=bn(f);p&&p.scrollBy({top:d.y,left:d.x})}},[t,a,i,r,n])}const tt=c.createContext({...q,scaleX:1,scaleY:1});var oe;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(oe||(oe={}));const Ks=c.memo(function(t){var n,r,s,o;let{id:a,accessibility:i,autoScroll:u=!0,children:f,sensors:h=ks,collisionDetection:d=_r,measuring:p,modifiers:v,...m}=t;const g=c.useReducer(zs,void 0,Ps),[x,b]=g,[y,w]=Br(),[T,N]=c.useState(oe.Uninitialized),j=T===oe.Initialized,{draggable:{active:C,nodes:S,translate:E},droppable:{containers:k}}=x,A=C!=null?S.get(C):null,V=c.useRef({initial:null,translated:null}),_=c.useMemo(()=>{var L;return C!=null?{id:C,data:(L=A==null?void 0:A.data)!=null?L:Is,rect:V}:null},[C,A]),Z=c.useRef(null),[Tt,Ot]=c.useState(null),[J,kt]=c.useState(null),le=Te(m,Object.values(m)),nt=Ze("DndDescribedBy",a),It=c.useMemo(()=>k.getEnabled(),[k]),ce=Bs(p),{droppableRects:he,measureDroppableContainers:Fe,measuringScheduled:Lt}=Cs(It,{dragging:j,dependencies:[E.x,E.y],config:ce.droppable}),X=ys(S,C),Pt=c.useMemo(()=>J?He(J):null,[J]),zt=Xn(),Ft=Ss(X,ce.draggable.measure);$s({activeNode:C!=null?S.get(C):null,config:zt.layoutShiftCompensation,initialRect:Ft,measure:ce.draggable.measure});const U=rn(X,ce.draggable.measure,Ft),rt=rn(X?X.parentElement:null),ue=c.useRef({activatorEvent:null,active:null,activeNode:X,collisionRect:null,collisions:null,droppableRects:he,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:k,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),Bt=k.getNodeFor((n=ue.current.over)==null?void 0:n.id),de=Os({measure:ce.dragOverlay.measure}),Be=(r=de.nodeRef.current)!=null?r:X,ge=j?(s=de.rect)!=null?s:U:null,$t=!!(de.nodeRef.current&&de.rect),Kt=js($t?null:U),st=En(Be?P(Be):null),ee=Es(j?Bt??X:null),$e=Ts(ee),Ke=Tn(v,{transform:{x:E.x-Kt.x,y:E.y-Kt.y,scaleX:1,scaleY:1},activatorEvent:J,active:_,activeNodeRect:U,containerNodeRect:rt,draggingNodeRect:ge,over:ue.current.over,overlayNodeRect:de.rect,scrollableAncestors:ee,scrollableAncestorRects:$e,windowRect:st}),Xt=Pt?be(Pt,E):null,Ut=Rs(ee),Ln=on(Ut),Pn=on(Ut,[U]),pe=be(Ke,Ln),ve=ge?Qr(ge,Ke):null,we=_&&ve?d({active:_,collisionRect:ve,droppableRects:he,droppableContainers:It,pointerCoordinates:Xt}):null,qt=Hr(we,"id"),[te,Yt]=c.useState(null),zn=$t?Ke:be(Ke,Pn),Fn=Jr(zn,(o=te==null?void 0:te.rect)!=null?o:null,U),ot=c.useRef(null),Wt=c.useCallback((L,z)=>{let{sensor:F,options:ne}=z;if(Z.current==null)return;const $=S.get(Z.current);if(!$)return;const B=L.nativeEvent,Y=new F({active:Z.current,activeNode:$,event:B,options:ne,context:ue,onAbort(I){if(!S.get(I))return;const{onDragAbort:W}=le.current,G={id:I};W==null||W(G),y({type:"onDragAbort",event:G})},onPending(I,re,W,G){if(!S.get(I))return;const{onDragPending:Se}=le.current,se={id:I,constraint:re,initialCoordinates:W,offset:G};Se==null||Se(se),y({type:"onDragPending",event:se})},onStart(I){const re=Z.current;if(re==null)return;const W=S.get(re);if(!W)return;const{onDragStart:G}=le.current,Ce={activatorEvent:B,active:{id:re,data:W.data,rect:V}};Ne.unstable_batchedUpdates(()=>{G==null||G(Ce),N(oe.Initializing),b({type:M.DragStart,initialCoordinates:I,active:re}),y({type:"onDragStart",event:Ce}),Ot(ot.current),kt(B)})},onMove(I){b({type:M.DragMove,coordinates:I})},onEnd:me(M.DragEnd),onCancel:me(M.DragCancel)});ot.current=Y;function me(I){return async function(){const{active:W,collisions:G,over:Ce,scrollAdjustedTranslate:Se}=ue.current;let se=null;if(W&&Se){const{cancelDrop:De}=le.current;se={activatorEvent:B,active:W,collisions:G,delta:Se,over:Ce},I===M.DragEnd&&typeof De=="function"&&await Promise.resolve(De(se))&&(I=M.DragCancel)}Z.current=null,Ne.unstable_batchedUpdates(()=>{b({type:I}),N(oe.Uninitialized),Yt(null),Ot(null),kt(null),ot.current=null;const De=I===M.DragEnd?"onDragEnd":"onDragCancel";if(se){const it=le.current[De];it==null||it(se),y({type:De,event:se})}})}}},[S]),Bn=c.useCallback((L,z)=>(F,ne)=>{const $=F.nativeEvent,B=S.get(ne);if(Z.current!==null||!B||$.dndKit||$.defaultPrevented)return;const Y={active:B};L(F,z.options,Y)===!0&&($.dndKit={capturedBy:z.sensor},Z.current=ne,Wt(F,z))},[S,Wt]),Ht=ws(h,Bn);As(h),Q(()=>{U&&T===oe.Initializing&&N(oe.Initialized)},[U,T]),c.useEffect(()=>{const{onDragMove:L}=le.current,{active:z,activatorEvent:F,collisions:ne,over:$}=ue.current;if(!z||!F)return;const B={active:z,activatorEvent:F,collisions:ne,delta:{x:pe.x,y:pe.y},over:$};Ne.unstable_batchedUpdates(()=>{L==null||L(B),y({type:"onDragMove",event:B})})},[pe.x,pe.y]),c.useEffect(()=>{const{active:L,activatorEvent:z,collisions:F,droppableContainers:ne,scrollAdjustedTranslate:$}=ue.current;if(!L||Z.current==null||!z||!$)return;const{onDragOver:B}=le.current,Y=ne.get(qt),me=Y&&Y.rect.current?{id:Y.id,rect:Y.rect.current,data:Y.data,disabled:Y.disabled}:null,I={active:L,activatorEvent:z,collisions:F,delta:{x:$.x,y:$.y},over:me};Ne.unstable_batchedUpdates(()=>{Yt(me),B==null||B(I),y({type:"onDragOver",event:I})})},[qt]),Q(()=>{ue.current={activatorEvent:J,active:_,activeNode:X,collisionRect:ve,collisions:we,droppableRects:he,draggableNodes:S,draggingNode:Be,draggingNodeRect:ge,droppableContainers:k,over:te,scrollableAncestors:ee,scrollAdjustedTranslate:pe},V.current={initial:ge,translated:ve}},[_,X,we,ve,S,Be,ge,he,k,te,ee,pe]),ms({...zt,delta:E,draggingRect:ve,pointerCoordinates:Xt,scrollableAncestors:ee,scrollableAncestorRects:$e});const $n=c.useMemo(()=>({active:_,activeNode:X,activeNodeRect:U,activatorEvent:J,collisions:we,containerNodeRect:rt,dragOverlay:de,draggableNodes:S,droppableContainers:k,droppableRects:he,over:te,measureDroppableContainers:Fe,scrollableAncestors:ee,scrollableAncestorRects:$e,measuringConfiguration:ce,measuringScheduled:Lt,windowRect:st}),[_,X,U,J,we,rt,de,S,k,he,te,Fe,ee,$e,ce,Lt,st]),Kn=c.useMemo(()=>({activatorEvent:J,activators:Ht,active:_,activeNodeRect:U,ariaDescribedById:{draggable:nt},dispatch:b,draggableNodes:S,over:te,measureDroppableContainers:Fe}),[J,Ht,_,U,b,nt,S,te,Fe]);return R.createElement(pn.Provider,{value:w},R.createElement(ze.Provider,{value:Kn},R.createElement(Mn.Provider,{value:$n},R.createElement(tt.Provider,{value:Fn},f)),R.createElement(Fs,{disabled:(i==null?void 0:i.restoreFocus)===!1})),R.createElement(Xr,{...i,hiddenTextDescribedById:nt}));function Xn(){const L=(Tt==null?void 0:Tt.autoScrollEnabled)===!1,z=typeof u=="object"?u.enabled===!1:u===!1,F=j&&!L&&!z;return typeof u=="object"?{...u,enabled:F}:{enabled:F}}}),Xs=c.createContext(null),ln="button",Us="Draggable";function qs(e){let{id:t,data:n,disabled:r=!1,attributes:s}=e;const o=Ze(Us),{activators:a,activatorEvent:i,active:u,activeNodeRect:f,ariaDescribedById:h,draggableNodes:d,over:p}=c.useContext(ze),{role:v=ln,roleDescription:m="draggable",tabIndex:g=0}=s??{},x=(u==null?void 0:u.id)===t,b=c.useContext(x?tt:Xs),[y,w]=qe(),[T,N]=qe(),j=Ms(a,t),C=Te(n);Q(()=>(d.set(t,{id:t,key:o,node:y,activatorNode:T,data:C}),()=>{const E=d.get(t);E&&E.key===o&&d.delete(t)}),[d,t]);const S=c.useMemo(()=>({role:v,tabIndex:g,"aria-disabled":r,"aria-pressed":x&&v===ln?!0:void 0,"aria-roledescription":m,"aria-describedby":h.draggable}),[r,v,g,x,m,h.draggable]);return{active:u,activatorEvent:i,activeNodeRect:f,attributes:S,isDragging:x,listeners:r?void 0:j,node:y,over:p,setNodeRef:w,setActivatorNodeRef:N,transform:b}}function Ys(){return c.useContext(Mn)}const Ws="Droppable",Hs={timeout:25};function Vs(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:s}=e;const o=Ze(Ws),{active:a,dispatch:i,over:u,measureDroppableContainers:f}=c.useContext(ze),h=c.useRef({disabled:n}),d=c.useRef(!1),p=c.useRef(null),v=c.useRef(null),{disabled:m,updateMeasurementsFor:g,timeout:x}={...Hs,...s},b=Te(g??r),y=c.useCallback(()=>{if(!d.current){d.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{f(Array.isArray(b.current)?b.current:[b.current]),v.current=null},x)},[x]),w=et({callback:y,disabled:m||!a}),T=c.useCallback((S,E)=>{w&&(E&&(w.unobserve(E),d.current=!1),S&&w.observe(S))},[w]),[N,j]=qe(T),C=Te(t);return c.useEffect(()=>{!w||!N.current||(w.disconnect(),d.current=!1,w.observe(N.current))},[N,w]),c.useEffect(()=>(i({type:M.RegisterDroppable,element:{id:r,key:o,disabled:n,node:N,rect:p,data:C}}),()=>i({type:M.UnregisterDroppable,key:o,id:r})),[r]),c.useEffect(()=>{n!==h.current.disabled&&(i({type:M.SetDroppableDisabled,id:r,key:o,disabled:n}),h.current.disabled=n)},[r,o,n,i]),{active:a,rect:p,isOver:(u==null?void 0:u.id)===r,node:N,over:u,setNodeRef:j}}function _s(e){let{animation:t,children:n}=e;const[r,s]=c.useState(null),[o,a]=c.useState(null),i=Ye(n);return!n&&!r&&i&&s(i),Q(()=>{if(!o)return;const u=r==null?void 0:r.key,f=r==null?void 0:r.props.id;if(u==null||f==null){s(null);return}Promise.resolve(t(f,o)).then(()=>{s(null)})},[t,r,o]),R.createElement(R.Fragment,null,n,r?c.cloneElement(r,{ref:a}):null)}const Js={x:0,y:0,scaleX:1,scaleY:1};function Gs(e){let{children:t}=e;return R.createElement(ze.Provider,{value:An},R.createElement(tt.Provider,{value:Js},t))}const Qs={position:"fixed",touchAction:"none"},Zs=e=>Nt(e)?"transform 250ms ease":void 0,eo=c.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:s,children:o,className:a,rect:i,style:u,transform:f,transition:h=Zs}=e;if(!i)return null;const d=s?f:{...f,scaleX:1,scaleY:1},p={...Qs,width:i.width,height:i.height,top:i.top,left:i.left,transform:Oe.Transform.toString(d),transformOrigin:s&&r?Yr(r,i):void 0,transition:typeof h=="function"?h(r):h,...u};return R.createElement(n,{className:a,style:p,ref:t},o)}),to=e=>t=>{let{active:n,dragOverlay:r}=t;const s={},{styles:o,className:a}=e;if(o!=null&&o.active)for(const[i,u]of Object.entries(o.active))u!==void 0&&(s[i]=n.node.style.getPropertyValue(i),n.node.style.setProperty(i,u));if(o!=null&&o.dragOverlay)for(const[i,u]of Object.entries(o.dragOverlay))u!==void 0&&r.node.style.setProperty(i,u);return a!=null&&a.active&&n.node.classList.add(a.active),a!=null&&a.dragOverlay&&r.node.classList.add(a.dragOverlay),function(){for(const[u,f]of Object.entries(s))n.node.style.setProperty(u,f);a!=null&&a.active&&n.node.classList.remove(a.active)}},no=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:Oe.Transform.toString(t)},{transform:Oe.Transform.toString(n)}]},ro={duration:250,easing:"ease",keyframes:no,sideEffects:to({styles:{active:{opacity:"0"}}})};function so(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:s}=e;return Qe((o,a)=>{if(t===null)return;const i=n.get(o);if(!i)return;const u=i.node.current;if(!u)return;const f=Rn(a);if(!f)return;const{transform:h}=P(a).getComputedStyle(a),d=mn(h);if(!d)return;const p=typeof t=="function"?t:oo(t);return Dn(u,s.draggable.measure),p({active:{id:o,data:i.data,node:u,rect:s.draggable.measure(u)},draggableNodes:n,dragOverlay:{node:a,rect:s.dragOverlay.measure(f)},droppableContainers:r,measuringConfiguration:s,transform:d})})}function oo(e){const{duration:t,easing:n,sideEffects:r,keyframes:s}={...ro,...e};return o=>{let{active:a,dragOverlay:i,transform:u,...f}=o;if(!t)return;const h={x:i.rect.left-a.rect.left,y:i.rect.top-a.rect.top},d={scaleX:u.scaleX!==1?a.rect.width*u.scaleX/i.rect.width:1,scaleY:u.scaleY!==1?a.rect.height*u.scaleY/i.rect.height:1},p={x:u.x-h.x,y:u.y-h.y,...d},v=s({...f,active:a,dragOverlay:i,transform:{initial:u,final:p}}),[m]=v,g=v[v.length-1];if(JSON.stringify(m)===JSON.stringify(g))return;const x=r==null?void 0:r({active:a,dragOverlay:i,...f}),b=i.node.animate(v,{duration:t,easing:n,fill:"forwards"});return new Promise(y=>{b.onfinish=()=>{x==null||x(),y()}})}}let cn=0;function io(e){return c.useMemo(()=>{if(e!=null)return cn++,cn},[e])}const ao=R.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:r,style:s,transition:o,modifiers:a,wrapperElement:i="div",className:u,zIndex:f=999}=e;const{activatorEvent:h,active:d,activeNodeRect:p,containerNodeRect:v,draggableNodes:m,droppableContainers:g,dragOverlay:x,over:b,measuringConfiguration:y,scrollableAncestors:w,scrollableAncestorRects:T,windowRect:N}=Ys(),j=c.useContext(tt),C=io(d==null?void 0:d.id),S=Tn(a,{activatorEvent:h,active:d,activeNodeRect:p,containerNodeRect:v,draggingNodeRect:x.rect,over:b,overlayNodeRect:x.rect,scrollableAncestors:w,scrollableAncestorRects:T,transform:j,windowRect:N}),E=Mt(p),k=so({config:r,draggableNodes:m,droppableContainers:g,measuringConfiguration:y}),A=E?x.setRef:void 0;return R.createElement(Gs,null,R.createElement(_s,{animation:k},d&&C?R.createElement(eo,{key:C,id:d.id,ref:A,as:i,activatorEvent:h,adjustScale:t,className:u,transition:o,rect:E,style:{zIndex:f,...s},transform:S},n):null))});function lo(e){return e?e instanceof fn?e.toDate():e instanceof Date?e:null:null}function On({contact:e,isDragging:t,onOpenConversation:n,onEdit:r}){return l.jsxs("div",{className:H("rounded-xl border border-white/10 bg-white/5 p-3 cursor-grab active:cursor-grabbing","transition-all hover:border-white/20 hover:bg-white/8",t&&"opacity-50"),children:[l.jsxs("div",{className:"flex items-start justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[l.jsx("div",{className:"h-7 w-7 rounded-full bg-brand-600/20 flex items-center justify-center text-brand-400 text-xs font-semibold shrink-0",children:e.name.charAt(0).toUpperCase()}),l.jsxs("div",{className:"min-w-0",children:[l.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.name}),e.company&&l.jsx("p",{className:"text-xs text-gray-500 truncate",children:e.company})]})]}),l.jsxs("div",{className:"flex gap-1 shrink-0",children:[r&&l.jsx("button",{onClick:s=>{s.stopPropagation(),r(e.id)},className:"p-1 rounded text-gray-600 hover:text-gray-300 hover:bg-white/10",children:l.jsx(er,{size:11})}),l.jsx("button",{onClick:s=>{s.stopPropagation(),n(e.id)},className:"p-1 rounded text-gray-600 hover:text-brand-400 hover:bg-brand-600/10",children:l.jsx(Ue,{size:11})})]})]}),e.funnelUpdatedAt&&l.jsx("p",{className:"text-xs text-gray-600 mt-1.5",children:Ct(lo(e.funnelUpdatedAt))})]})}function co({stage:e,contacts:t,onOpenConversation:n}){const{setNodeRef:r,isOver:s}=Vs({id:e.id});return l.jsxs("div",{className:"flex flex-col min-w-[220px] w-[220px]",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2 px-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"h-2 w-2 rounded-full",style:{backgroundColor:e.color}}),l.jsx("span",{className:"text-xs font-semibold text-gray-300",children:e.name})]}),l.jsx("span",{className:"text-xs text-gray-600 bg-white/8 rounded-full px-2 py-0.5",children:t.length})]}),l.jsxs("div",{ref:r,className:H("flex-1 min-h-[200px] rounded-xl p-2 space-y-2 border border-dashed transition-colors",s?"border-brand-500/60 bg-brand-600/5":"border-white/8 bg-white/3"),children:[t.map(o=>{const{attributes:a,listeners:i,setNodeRef:u,transform:f}=qs({id:o.id}),h=f?{transform:`translate3d(${f.x}px, ${f.y}px, 0)`}:void 0;return l.jsx("div",{ref:u,style:h,...a,...i,children:l.jsx(On,{contact:o,onOpenConversation:n})},o.id)}),t.length===0&&l.jsx("div",{className:"flex items-center justify-center h-16",children:l.jsx("p",{className:"text-xs text-gray-700",children:"Arrastra aquí"})})]})]})}function uo({contacts:e,orgId:t,onOpenConversation:n}){const r=Jn(t),[s,o]=c.useState(null),a=qr(Ur(At,{activationConstraint:{distance:5}})),i=at.reduce((d,p)=>(d[p.id]=e.filter(v=>v.funnelStage===p.id),d),{});e.filter(d=>!d.funnelStage);function u(d){o(d.active.id)}async function f(d){o(null);const{active:p,over:v}=d;if(!v||p.id===v.id)return;const m=v.id;at.find(g=>g.id===m)&&await r.mutateAsync({id:p.id,stage:m})}const h=s?e.find(d=>d.id===s):null;return l.jsxs(Ks,{sensors:a,onDragStart:u,onDragEnd:f,children:[l.jsx("div",{className:"flex gap-3 overflow-x-auto pb-4",children:at.map(d=>l.jsx(co,{stage:d,contacts:i[d.id]??[],onOpenConversation:n},d.id))}),l.jsx(ao,{children:h&&l.jsx("div",{className:"rotate-2 opacity-90",children:l.jsx(On,{contact:h,isDragging:!0,onOpenConversation:()=>{}})})})]})}const fo=sr({contactId:Jt().min(1,"Selecciona un contacto"),platform:or(["whatsapp","instagram","messenger"],{required_error:"Selecciona una plataforma"}),initialMessage:Jt().optional()}),ho=[{value:"whatsapp",label:"WhatsApp",icon:"📱"},{value:"instagram",label:"Instagram",icon:"📷"},{value:"messenger",label:"Messenger",icon:"💬"}];function go({open:e,onOpenChange:t,contacts:n,orgId:r,userName:s,onCreate:o,isCreating:a}){const{register:i,control:u,handleSubmit:f,reset:h,watch:d,formState:{errors:p}}=nr({resolver:rr(fo)});d("platform");async function v(m){var x;if(!r)return;const g=n.find(b=>b.id===m.contactId);g&&(await o({contactId:g.id,contactName:g.name,contactPhone:g.phone,platform:m.platform,orgId:r,initialMessage:((x=m.initialMessage)==null?void 0:x.trim())||void 0,senderName:s}),h())}return l.jsx(ir,{open:e,onOpenChange:m=>{a||(t(m),h())},children:l.jsxs(ar,{children:[l.jsx(lr,{children:l.jsx(cr,{children:"Nuevo Chat"})}),l.jsxs("form",{onSubmit:f(v),className:"space-y-4",children:[l.jsxs("div",{className:"space-y-1.5",children:[l.jsx(lt,{children:"Contacto *"}),l.jsx(_t,{name:"contactId",control:u,render:({field:m})=>l.jsxs(dr,{value:m.value,onValueChange:m.onChange,children:[l.jsx(fr,{children:l.jsx(hr,{placeholder:"Selecciona un contacto..."})}),l.jsx(gr,{children:n.map(g=>l.jsxs(pr,{value:g.id,children:[g.name," ",g.company?`— ${g.company}`:""]},g.id))})]})}),p.contactId&&l.jsx("p",{className:"text-xs text-red-400",children:p.contactId.message})]}),l.jsxs("div",{className:"space-y-1.5",children:[l.jsx(lt,{children:"Plataforma *"}),l.jsx(_t,{name:"platform",control:u,render:({field:m})=>l.jsx("div",{className:"grid grid-cols-3 gap-2",children:ho.map(g=>l.jsxs("button",{type:"button",onClick:()=>m.onChange(g.value),className:H("flex flex-col items-center gap-1.5 p-3 rounded-xl border text-sm transition-all",m.value===g.value?"border-brand-500 bg-brand-600/15 text-white":"border-white/15 text-gray-400 hover:bg-white/5"),children:[l.jsx("span",{className:"text-xl",children:g.icon}),l.jsx("span",{children:g.label})]},g.value))})}),p.platform&&l.jsx("p",{className:"text-xs text-red-400",children:p.platform.message})]}),l.jsxs("div",{className:"space-y-1.5",children:[l.jsx(lt,{children:"Mensaje inicial (opcional)"}),l.jsx(tr,{placeholder:"Escribe el primer mensaje...",rows:3,...i("initialMessage")})]}),l.jsxs(ur,{children:[l.jsx(fe,{type:"button",variant:"outline",onClick:()=>{t(!1),h()},disabled:a,children:"Cancelar"}),l.jsx(fe,{type:"submit",loading:a,children:"Iniciar Chat"})]})]})]})})}const kn={whatsapp:"📱",instagram:"📷",messenger:"💬"};function In(e){return e?e instanceof fn?e.toDate():e instanceof Date?e:null:null}function po({msg:e}){const t=e.role==="agent"||e.role==="ai";return l.jsx("div",{className:H("flex",t?"justify-end":"justify-start"),children:l.jsxs("div",{className:H("max-w-[75%] rounded-2xl px-3.5 py-2 text-sm",t?"bg-brand-600 text-white rounded-br-sm":"bg-white/10 text-gray-100 rounded-bl-sm",e.role==="ai"&&"bg-purple-600/80"),children:[e.role==="ai"&&l.jsx("p",{className:"text-xs text-purple-200 mb-1 font-medium",children:"🤖 Agente IA"}),l.jsx("p",{className:"whitespace-pre-wrap break-words",children:e.text}),l.jsx("p",{className:H("text-xs mt-1",t?"text-white/60":"text-gray-500"),children:Ct(In(e.timestamp))})]})})}function vo({conv:e,onClose:t,userName:n}){const r=e.orgId,{messages:s,loading:o}=Nr(e.id),a=jr(),i=Er(r),u=Rr(r),[f,h]=c.useState(""),d=c.useRef(null);c.useEffect(()=>{var m;(m=d.current)==null||m.scrollIntoView({behavior:"smooth"})},[s]);async function p(){const m=f.trim();m&&(h(""),await a.mutateAsync({convId:e.id,text:m,senderName:n,role:"agent"}))}async function v(){confirm("¿Eliminar esta conversación? Esta acción no se puede deshacer.")&&(await i.mutateAsync(e.id),t())}return l.jsxs("div",{className:"flex h-full flex-col",children:[l.jsxs("div",{className:"flex items-center gap-3 border-b border-white/8 px-4 py-3 shrink-0",children:[l.jsx("button",{onClick:t,className:"p-1 rounded text-gray-500 hover:text-white lg:hidden",children:l.jsx(wr,{size:16})}),l.jsx("div",{className:"h-8 w-8 rounded-full bg-brand-600/20 flex items-center justify-center text-brand-400 text-sm font-semibold shrink-0",children:e.contactName.charAt(0).toUpperCase()}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-sm font-medium text-white truncate",children:e.contactName}),l.jsxs("p",{className:"text-xs text-gray-500",children:[kn[e.platform]," ",e.platform,e.contactPhone?` · ${e.contactPhone}`:""]})]}),l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx(fe,{variant:"ghost",size:"icon-sm",title:e.aiEnabled?"Desactivar IA":"Activar IA",onClick:()=>u.mutate({convId:e.id,enabled:!e.aiEnabled}),className:e.aiEnabled?"text-purple-400":"text-gray-500",children:e.aiEnabled?l.jsx(gt,{size:15}):l.jsx(xr,{size:15})}),l.jsx(fe,{variant:"ghost",size:"icon-sm",className:"text-gray-500 hover:text-red-400",onClick:v,children:l.jsx(mr,{size:14})}),l.jsx(fe,{variant:"ghost",size:"icon-sm",className:"text-gray-500 lg:hidden",onClick:t,children:l.jsx(Vn,{size:14})})]})]}),e.aiEnabled&&l.jsxs("div",{className:"bg-purple-600/10 border-b border-purple-500/20 px-4 py-2 text-xs text-purple-300 flex items-center gap-2",children:[l.jsx(gt,{size:12}),"Agente IA activo en esta conversación"]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[o&&l.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Cargando mensajes..."}),!o&&s.length===0&&l.jsxs("div",{className:"flex flex-col items-center justify-center h-32 gap-2",children:[l.jsx(Ue,{size:24,className:"text-gray-700"}),l.jsx("p",{className:"text-sm text-gray-600",children:"Sin mensajes aún"})]}),s.map(m=>l.jsx(po,{msg:m},m.id)),l.jsx("div",{ref:d})]}),l.jsx("div",{className:"border-t border-white/8 p-3 shrink-0",children:l.jsxs("div",{className:"flex items-end gap-2",children:[l.jsx("textarea",{className:"flex-1 resize-none rounded-xl border border-white/15 bg-white/5 px-3 py-2 text-sm text-gray-100 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent max-h-32",placeholder:"Escribe un mensaje...",rows:1,value:f,onChange:m=>h(m.target.value),onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),p())}}),l.jsx(fe,{size:"icon",onClick:p,disabled:!f.trim()||a.isPending,loading:a.isPending,children:l.jsx(Sr,{size:15})})]})})]})}function mo({conv:e,selected:t,onClick:n}){const r=In(e.lastMessageAt);return l.jsxs("button",{onClick:n,className:H("w-full flex items-start gap-3 px-3 py-3 rounded-xl text-left transition-colors",t?"bg-brand-600/20":"hover:bg-white/5"),children:[l.jsx("div",{className:"h-9 w-9 rounded-full bg-brand-600/20 flex items-center justify-center text-brand-400 text-sm font-semibold shrink-0 mt-0.5",children:e.contactName.charAt(0).toUpperCase()}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center justify-between gap-1",children:[l.jsx("p",{className:H("text-sm font-medium truncate",t?"text-white":"text-gray-200"),children:e.contactName}),r&&l.jsx("span",{className:"text-xs text-gray-600 shrink-0",children:Ct(r)})]}),l.jsxs("p",{className:"text-xs text-gray-500 truncate mt-0.5",children:[kn[e.platform]," ",e.lastMessage??"Sin mensajes"]})]}),e.aiEnabled&&l.jsx(gt,{size:12,className:"text-purple-400 mt-1 shrink-0"})]})}function Io(){const{userData:e,organization:t}=Hn(),n=(e==null?void 0:e.orgId)??(t==null?void 0:t.id),{data:r=[],isLoading:s}=Dr(n),{data:o=[]}=Gn(n),a=Ar(n),[i,u]=c.useState("list"),[f,h]=c.useState(null),[d,p]=c.useState(""),[v,m]=c.useState(!1),g=r.find(b=>b.id===f)??null,x=r.filter(b=>{var y;return b.contactName.toLowerCase().includes(d.toLowerCase())||((y=b.lastMessage)==null?void 0:y.toLowerCase().includes(d.toLowerCase()))});return l.jsxs("div",{className:"flex h-[calc(100vh-3.5rem)] -m-4 lg:-m-6 overflow-hidden",children:[l.jsxs("div",{className:H("flex flex-col border-r border-white/8 bg-gray-950","w-full lg:w-80 xl:w-96 shrink-0",g?"hidden lg:flex":"flex"),children:[l.jsxs("div",{className:"p-3 border-b border-white/8 space-y-2 shrink-0",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx(Qn,{value:i,onValueChange:b=>u(b),children:l.jsxs(Zn,{children:[l.jsx(Vt,{value:"list",children:"Lista"}),l.jsx(Vt,{value:"funnel",children:"Funnel"})]})}),l.jsxs(fe,{size:"sm",onClick:()=>m(!0),children:[l.jsx(vr,{size:13})," Nuevo"]})]}),l.jsx("input",{className:"w-full rounded-lg border border-white/15 bg-white/5 px-3 py-1.5 text-sm text-gray-100 placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-transparent",placeholder:"Buscar conversación...",value:d,onChange:b=>p(b.target.value)})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-2",children:[i==="list"&&l.jsxs(l.Fragment,{children:[s&&l.jsx("p",{className:"text-sm text-gray-600 text-center py-8 animate-pulse",children:"Cargando..."}),!s&&x.length===0&&l.jsxs("div",{className:"flex flex-col items-center justify-center py-16 gap-3",children:[l.jsx(Ue,{size:32,className:"text-gray-700"}),l.jsx("p",{className:"text-sm text-gray-600",children:d?"Sin resultados":"Sin conversaciones aún"})]}),x.map(b=>l.jsx(mo,{conv:b,selected:b.id===f,onClick:()=>h(b.id)},b.id))]}),i==="funnel"&&l.jsx(uo,{contacts:o,orgId:n,onOpenConversation:b=>{const y=r.find(w=>w.contactId===b);y?h(y.id):ie.info("Sin conversación activa para este contacto"),u("list")}})]})]}),l.jsx("div",{className:H("flex-1 overflow-hidden",g?"flex flex-col":"hidden lg:flex lg:flex-col"),children:g?l.jsx(vo,{conv:g,onClose:()=>h(null),userName:(e==null?void 0:e.name)??"Agente"}):l.jsxs("div",{className:"flex flex-col items-center justify-center h-full gap-4 text-center px-4",children:[l.jsx(Ue,{size:48,className:"text-gray-700"}),l.jsxs("div",{children:[l.jsx("p",{className:"font-medium text-gray-400",children:"Selecciona una conversación"}),l.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Elige una de la lista para ver los mensajes"})]})]})}),l.jsx(go,{open:v,onOpenChange:m,contacts:o,orgId:n,userName:(e==null?void 0:e.name)??"Agente",onCreate:async b=>{await a.mutateAsync(b),m(!1)},isCreating:a.isPending})]})}export{Io as default};
